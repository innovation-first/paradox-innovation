variables:
  GIT_SUBMODULE_STRATEGY: recursive
  GIT_SUBMODULE_DEPTH: 1
  GIT_STRATEGY: clone

stages:          
  - build
  - deploy

build-job:
  stage: build
  image: alpine
  script:
    - apk add --no-cache --repository=https://dl-cdn.alpinelinux.org/alpine/edge/community hugo
    - hugo -d public/blog/
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
push-back-to-remote:
  stage: deploy
  image: alpine
  script:
    - ls
    - apk add git
    - git config user.email "ci-bot@example.xyz"
    - git config user.name "ci-bot"
    - git remote add gitlab_origin https://gitlab-ci-token:$ACCESS_TOKEN@gitlab.thalesdigital.io/tsn/innovation/projects/blog.git
    - git add public/
    - git commit -m "push back from pipeline" --allow-empty
    - git push gitlab_origin HEAD:main -o ci.skip
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
